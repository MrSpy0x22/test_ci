dist: xenial
language: php
php:
  - 7.2
services:
  - mysql
before_install:
  - sudo apt-get install git -y  
  - cd ~
  - git clone https://github.com/MrSpy0x22/test_ci.git
  - cd test_ci
  - openssl aes-256-cbc -K $encrypted_4455a229d80f_key -iv $encrypted_4455a229d80f_iv -in SSH_KEY_NAME.enc -out SSH_KEY_NAME -d
  - chmod 600 SSH_KEY_NAME
  - eval "$(ssh-agent -s)"
  - ssh-add SSH_KEY_NAME
before_script:
  - npm install
  - wget -O phpunit https://phar.phpunit.de/phpunit-8.phar
  - chmod +x phpunit
  - ./phpunit --version
  - mysql -e "CREATE DATABASE ci_test"
  - mysql -u root ci_test < prepare_mysql.sql
script:
  - php -l index.php
after_success:
  - rsync -av --delete -e ssh travis_deployer@polskiegw.pl:/var/www/html/test_ci/ $(pwd)
branches:
  only:
    - master
addons:
  ssh_known_hosts: polskiegw.pl